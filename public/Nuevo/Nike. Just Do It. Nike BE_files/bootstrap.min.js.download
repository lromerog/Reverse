var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,h,p){if(f==Array.prototype||f==Object.prototype)return f;f[h]=p.value;return f};
$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var h=0;h<f.length;++h){var p=f[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,h){var p=$jscomp.propertyToPolyfillSymbol[h];if(null==p)return f[h];p=f[p];return void 0!==p?p:f[h]};$jscomp.polyfill=function(f,h,p,q){h&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,h,p,q):$jscomp.polyfillUnisolated(f,h,p,q))};
$jscomp.polyfillUnisolated=function(f,h,p,q){p=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var u=f[q];if(!(u in p))return;p=p[u]}f=f[f.length-1];q=p[f];h=h(q);h!=q&&null!=h&&$jscomp.defineProperty(p,f,{configurable:!0,writable:!0,value:h})};
$jscomp.polyfillIsolated=function(f,h,p,q){var u=f.split(".");f=1===u.length;q=u[0];q=!f&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var E=0;E<u.length-1;E++){var H=u[E];if(!(H in q))return;q=q[H]}u=u[u.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[u]:null;h=h(p);null!=h&&(f?$jscomp.defineProperty($jscomp.polyfills,u,{configurable:!0,writable:!0,value:h}):h!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[u]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[u]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(u):$jscomp.POLYFILL_PREFIX+p+"$"+u),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[u],{configurable:!0,writable:!0,value:h})))};$jscomp.underscoreProtoCanBeSet=function(){var f={a:!0},h={};try{return h.__proto__=f,h.a}catch(p){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(f,h){f.__proto__=h;if(f.__proto__!==h)throw new TypeError(f+" is not extensible");return f}:null;$jscomp.arrayIteratorImpl=function(f){var h=0;return function(){return h<f.length?{done:!1,value:f[h++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};
$jscomp.makeIterator=function(f){var h="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return h?h.call(f):$jscomp.arrayIterator(f)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(f){if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(f){this.yieldResult=f};$jscomp.generator.Context.prototype.throw_=function(f){this.abruptCompletion_={exception:f,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(f){this.abruptCompletion_={return:f};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(f){this.abruptCompletion_={jumpTo:f};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(f,h){this.nextAddress=h;return{value:f}};$jscomp.generator.Context.prototype.yieldAll=function(f,h){f=$jscomp.makeIterator(f);var p=f.next();$jscomp.generator.ensureIteratorResultIsObject_(p);if(p.done)this.yieldResult=p.value,this.nextAddress=h;else return this.yieldAllIterator_=f,this.yield(p.value,h)};
$jscomp.generator.Context.prototype.jumpTo=function(f){this.nextAddress=f};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(f,h){this.catchAddress_=f;void 0!=h&&(this.finallyAddress_=h)};$jscomp.generator.Context.prototype.setFinallyBlock=function(f){this.catchAddress_=0;this.finallyAddress_=f||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(f,h){this.nextAddress=f;this.catchAddress_=h||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(f){this.catchAddress_=f||0;f=this.abruptCompletion_.exception;this.abruptCompletion_=null;return f};$jscomp.generator.Context.prototype.enterFinallyBlock=function(f,h,p){p?this.finallyContexts_[p]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=f||0;this.finallyAddress_=h||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(f,h){h=this.finallyContexts_.splice(h||0)[0];if(h=this.abruptCompletion_=this.abruptCompletion_||h){if(h.isException)return this.jumpToErrorHandler_();void 0!=h.jumpTo&&this.finallyAddress_<h.jumpTo?(this.nextAddress=h.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=f};$jscomp.generator.Context.prototype.forIn=function(f){return new $jscomp.generator.Context.PropertyIterator(f)};
$jscomp.generator.Context.PropertyIterator=function(f){this.object_=f;this.properties_=[];for(var h in f)this.properties_.push(h);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var f=this.properties_.pop();if(f in this.object_)return f}return null};$jscomp.generator.Engine_=function(f){this.context_=new $jscomp.generator.Context;this.program_=f};
$jscomp.generator.Engine_.prototype.next_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,f,this.context_.next_);this.context_.next_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(f){this.context_.start_();var h=this.context_.yieldAllIterator_;if(h)return this.yieldAllStep_("return"in h?h["return"]:function(p){return{value:p,done:!0}},f,this.context_.return);this.context_.return(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],f,this.context_.next_);this.context_.throw_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(f,h,p){try{var q=f.call(this.context_.yieldAllIterator_,h);$jscomp.generator.ensureIteratorResultIsObject_(q);if(!q.done)return this.context_.stop_(),q;var u=q.value}catch(E){return this.context_.yieldAllIterator_=null,this.context_.throw_(E),this.nextStep_()}this.context_.yieldAllIterator_=null;p.call(this.context_,u);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var f=this.program_(this.context_);if(f)return this.context_.stop_(),{value:f.value,done:!1}}catch(h){this.context_.yieldResult=void 0,this.context_.throw_(h)}this.context_.stop_();if(this.context_.abruptCompletion_){f=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(f.isException)throw f.exception;return{value:f.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(f){this.next=function(h){return f.next_(h)};this.throw=function(h){return f.throw_(h)};this.return=function(h){return f.return_(h)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(f,h){h=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(h));$jscomp.setPrototypeOf&&f.prototype&&$jscomp.setPrototypeOf(h,f.prototype);return h};
$jscomp.asyncExecutePromiseGenerator=function(f){function h(q){return f.next(q)}function p(q){return f.throw(q)}return new Promise(function(q,u){function E(H){H.done?q(H.value):Promise.resolve(H.value).then(h,p).then(E,u)}E(f.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(f){return $jscomp.asyncExecutePromiseGenerator(f())};$jscomp.asyncExecutePromiseGeneratorProgram=function(f){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(f)))};
(()=>{function f(a){try{var b=new URL(a);return!!b&&"https:"===b.protocol}catch(c){return!1}}function h(a=!1){return embeddedservice_bootstrap.isLocalStorageAvailable&&a?localStorage:embeddedservice_bootstrap.isSessionStorageAvailable?sessionStorage:void 0}function p(){let a,b;const c=JSON.stringify({});embeddedservice_bootstrap.isLocalStorageAvailable&&!localStorage.getItem(v)&&(a=c,localStorage.setItem(v,a));embeddedservice_bootstrap.isSessionStorageAvailable&&!sessionStorage.getItem(v)&&(b=c,sessionStorage.setItem(v,
b));(a||b)&&Y("ESW_3RDPARTY_STORAGE_SET_OBJECTS",{orgId:embeddedservice_bootstrap.settings.orgId,localStorageObj:a,sessionStorageObj:b});m("initializeWebStorage","web storage initialized")}function q(a,b=!0){let c;(b=h(b))&&(c=(b.getItem(v)&&JSON.parse(b.getItem(v))||{})[a]);return c}function u(a,b){if(b&&a){const c=b.getItem(v)&&JSON.parse(b.getItem(v))||{};Object.keys(a).forEach(d=>{c[d]=a[d]});0!==Object.keys(c).length&&b.setItem(v,JSON.stringify(c))}}function E(a,b,c=!0,d=!1){const e=h(c);if(e){const l=
e.getItem(v)&&JSON.parse(e.getItem(v))||{};l[a]=b;e.setItem(v,JSON.stringify(l));m("setItemInWebStorage",`${a} set in ${c?"localStorage":"sessionStorage"}`);d&&Y("ESW_3RDPARTY_STORAGE_SET_ITEMS",{orgId:embeddedservice_bootstrap.settings.orgId,key:a,value:b,inLocalStorage:c})}}function H(a){embeddedservice_bootstrap.isLocalStorageAvailable&&!a&&localStorage.removeItem(v);embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.removeItem(v);Y("ESW_3RDPARTY_STORAGE_CLEAR",embeddedservice_bootstrap.settings.orgId);
m("clearWebStorage","web storage cleared")}function Ib(){K=void 0;Da=new Promise(b=>{Ea=b});N={};Z={};F=void 0;Fa=Ga=aa=S=I=!1;ba=ca=void 0;Xa();Ya();Jb();m("clearInMemoryData","Cleared in-memory data.");const a=Za();m("clearInMemoryData",`Reset conversationId. Old conversationId: ${z} & New conversationId: ${a}`);z=a}function $a(a){const b=(c,d)=>{Object.keys(d).forEach(e=>{"object"===typeof c[e]&&typeof("object"===d[e])?b(c[e],d[e]):void 0===c[e]&&(c[e]=d[e])})};a&&"object"===typeof a&&b(embeddedservice_bootstrap.settings,
a)}function da(a,b,c){if((c||embeddedservice_bootstrap.settings.devMode)&&console&&console[a])console[a]("[EmbeddedServiceBootstrap] "+(Array.isArray(b)?b.join(", "):b))}function m(a,b,c){da("log",b,c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:z,convType:w(),hostUrl:window.location.href});qa(c)}function t(a,b,c){b?da("warn","Warning: "+b,c):da("warn","EmbeddedServiceBootstrap sent an anonymous warning.",
c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:z,convType:w(),hostUrl:window.location.href});qa(c)}function k(a,b,c,d){b?da("error",b,d):da("error","EmbeddedServiceBootstrap responded with an unspecified error.",d);d={};Object.assign(d,Object.assign({},{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",errMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:
""},c&&{errCode:c},{convId:z,convType:w(),hostUrl:window.location.href}));qa(null,d)}function Za(){const a=new Uint32Array(32);crypto.getRandomValues(a);let b="";for(let c=0;32>c;c++){if(8===c||12===c||16===c||20===c)b+="-";b=12===c?b+"4":16===c?b+"0123456789abcdef".charAt(a[c]&3|8):b+"0123456789abcdef".charAt(a[c]&15)}return b}function Ha(a,b,c){const d=document.createElementNS("http://www.w3.org/2000/svg",b);Object.getOwnPropertyNames(c).forEach(e=>{"children"===e?c.children.forEach(l=>{Ha(d,l.type,
l)}):d.setAttribute(e,c[e])});a.appendChild(document.createTextNode("\n"));a.appendChild(d);a.appendChild(document.createTextNode("\n"))}function Ia(a){const b=document.createElementNS("http://www.w3.org/2000/svg","svg");if(a)return b.setAttribute("focusable","false"),b.setAttribute("aria-hidden","true"),b.setAttribute("viewBox","0 0 100 100"),Array.isArray(a)?a.forEach(c=>{Ha(b,c.type,c)}):Ha(b,"path",{d:a}),b;k("renderSVG","Invalid icon data.")}function Kb(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},
{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout fetch".split(" ")}].forEach(a=>{a.functions.forEach(b=>{b in a.object&&!Function.prototype.toString.call(a.object[b]).match(/\[native code\]/)&&t("checkForNativeFunctionOverrides","EmbeddedService Messaging Bootstrap may not function correctly with this native JS function modified: "+a.name+"."+b,!0)})})}function ra(a){"string"!==typeof a?k("setAndStoreJwt",
`Expected to receive string, instead received: ${a}.`):(K=a,E(C.JWT,K))}function Lb(){window.addEventListener("message",ab);embeddedservice_bootstrap.isLocalStorageAvailable&&window.addEventListener("storage",bb);try{(new PerformanceObserver(a=>{a.getEntries().forEach(b=>{"reload"===b.type&&r("EMBEDDED_MESSAGING_APP_AFTER_REFRESH")})})).observe({type:"navigation",buffered:!0})}catch(a){k("addEventHandlers",`Unable to initialize PerformanceObserver ${a}.`)}}function ab(a){if(a&&a.data&&a.origin)if(embeddedservice_bootstrap.filePreviewFrame&&
embeddedservice_bootstrap.filePreviewFrame.contentWindow===a.source)switch(a.data.method){case "ESW_APP_SHOW_FILE_PREVIEW_FRAME":cb(!0);break;case "ESW_APP_HIDE_FILE_PREVIEW_FRAME":cb(!1);break;default:t("handleMessageEvent","Unrecognized event name: "+a.data.method)}else if(embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.contentWindow===a.source)switch(a.data.method){case "ESW_3RDPARTY_STORAGE_READY":db();break;case "ESW_3RDPARTY_STORAGE_RESPONSE":a.data.data&&
a.data.data.localStorage&&u(a.data.data.localStorage,localStorage);a.data.data&&a.data.data.sessionStorage&&u(a.data.data.sessionStorage,sessionStorage);eb();break;default:t("handleMessageEvent","Unrecognized event name: "+a.data.method)}else if(0===G().indexOf(a.origin)&&embeddedservice_bootstrap.isMessageFromSalesforceDomain(a.origin)&&embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame().contentWindow===a.source){var b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();switch(a.data.method){case "ESW_APP_READY_EVENT":Ea();
break;case "ESW_APP_LOADED":a=A();b=document.getElementById("embeddedMessagingIconContainer");let c=document.getElementById("embeddedMessagingIconChat"),d=document.getElementById("embeddedMessagingLoadingSpinner");embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()||t("handleAfterAppLoad","Embedded Messaging iframe not available for post-app-load updates.");a?(b&&d&&b.removeChild(d),c&&(c.style.display="none"),a.disabled=!1,a.classList.remove("embeddedMessagingConversationButtonLoading"),
a.classList.add("embeddedMessagingConversationButtonLoaded"),a.classList.add("no-hover")):t("handleAfterAppLoad","Embedded Messaging static button not available for post-app-load updates.");fb();S=!0;try{y("onEmbeddedMessagingInitSuccess")}catch(e){S=!1,k("emitEmbeddedMessagingInitSuccessEvent",`Something went wrong in firing onEmbeddedMessagingInitSuccess event ${e}.`)}break;case "ESW_APP_INITIALIZATION_ERROR":L();break;case "ESW_APP_MINIMIZE":embeddedservice_bootstrap.minimizeIframe(b,a.data.data);
break;case "ESW_APP_MAXIMIZE":embeddedservice_bootstrap.maximizeIframe(b,a.data.data);break;case "ESW_APP_RESET_INITIAL_STATE":T();break;case "ESW_SET_JWT_EVENT":ra(a.data.data);break;case "ESW_CLEAR_WEBSTORAGE_EVENT":H();break;case "ESW_DOWNLOAD_FILE":Mb(a.data.data);break;case "ESW_SET_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=a.data.data;"object"!==typeof a?k("storeFailedMessagesInWebStorage",`Expected to receive object, instead received: ${a}.`):E(C.FAILED_OUTBOUND_MESSAGE_ENTRIES,a,!1);break;case "ESW_CLEAN_UP_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=
C.FAILED_OUTBOUND_MESSAGE_ENTRIES;embeddedservice_bootstrap.isLocalStorageAvailable&&localStorage.getItem(v)&&(b=JSON.parse(localStorage.getItem(v))||{},delete b[a],localStorage.setItem(v,JSON.stringify(b)));embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.getItem(v)&&(b=JSON.parse(sessionStorage.getItem(v))||{},delete b[a],sessionStorage.setItem(v,JSON.stringify(b)));m("removeItemInWebStorage",`${a} removed from web storage`);break;case "ESW_APP_UPDATE_TITLE_NOTIFICATION":Xa(a.data.data);
break;case "ESW_APP_SEND_HIDDEN_PRECHAT_FIELDS":r("ESW_APP_RECEIVE_HIDDEN_PRECHAT_FIELDS",N);break;case "ESW_APP_SEND_AUTORESPONSE_PARAMETERS":r("ESW_APP_RECEIVE_AUTORESPONSE_PARAMETERS",Z);break;case "EMBEDDED_MESSAGING_IDENTITY_TOKEN_EXPIRED_EVENT":w()!==x.AUTH?t("handleIdentityTokenExpiredEvent","handleIdentityTokenExpiredEvent method called but User Verification isn\u2019t enabled in Messaging Settings."):y("onEmbeddedMessagingIdentityTokenExpired");break;case "EMBEDDED_MESSAGING_JWT_RETRIEVAL_FAILURE_EVENT":gb();
break;case "ESW_APP_PRECHAT_SUBMIT":Nb(a.data.data);break;case "ESW_APP_SHOW_MINIMIZED_STATE_NOTIFICATION":(a=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame())&&a.classList.add("hasMinimizedNotification");break;case "EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_EVENT":Ob();break;case "EMBEDDED_MESSAGING_DISPATCH_EVENT_TO_HOST":y(a.data.data&&a.data.data.eventName,{detail:a.data.data.eventDetails||{}});break;case "EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_RESPONSE":a=a.data.data;a.success?
ca():ba(a.error);ba=ca=void 0;break;case "EMBEDDED_MESSAGING_SCREENREADER_ANNOUNCEMENT":Pb(a.data.data);break;default:t("handleMessageEvent","Unrecognized event name: "+a.data.method)}}else k("handleMessageEvent",`Unexpected message origin: ${a.origin}`)}function hb(){y("onEmbeddedMessagingButtonClicked");return ib()}function bb(a){a&&a.key&&a.key===v&&null===a.newValue&&O()&&Ja(!1,!0)}function L(){aa=!0;try{qa(),y("onEmbeddedMessagingInitError")}catch(a){aa=!1,k("emitEmbeddedMessagingInitErrorEvent",
`Something went wrong in firing onEmbeddedMessagingInitError event ${a}.`)}}function sa(a){let b=ta()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad;b=void 0!==a&&null!==a?a:b;w()===x.AUTH&&(b=b&&ua(F));try{y("onEmbeddedMessagingChannelMenuVisibilityChanged",{detail:{devName:embeddedservice_bootstrap.settings.eswConfigDevName,isVisible:b}})}catch(c){k("emitEmbeddedMessagingChannelMenuVisibilityChangeEvent",`Something went wrong in firing emitEmbeddedMessagingChannelMenuVisibilityChange event ${c}.`)}}
function y(a,b={detail:{}}){if(!a)throw Error(`Expected an eventName parameter with a string value. Instead received ${a}.`);if(b&&!("detail"in b))throw Error(`The options parameter of the event is malformed: ${b}.`);try{"onEmbeddedMessagingConversationOpened"===a&&(Ga=!0),window.dispatchEvent(new CustomEvent(a,b))}catch(c){throw Error("Something went wrong while dispatching the event "+a+":"+c);}}function Xa(a){if(a){const b=JSON.parse(a)[0],c=jb;ea&&window.clearInterval(ea);ea=window.setInterval(()=>
{document.title=document.title===b?c:b},1E3)}else window.clearInterval(ea),ea=void 0,document.title=jb}function R(){return document.getElementById("embedded-messaging")}function A(){return document.getElementById("embeddedMessagingConversationButton")}function cb(a){var b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if(embeddedservice_bootstrap.filePreviewFrame&&b){if(a){if(embeddedservice_bootstrap.filePreviewFrame.classList.add("show"),embeddedservice_bootstrap.filePreviewFrame.contentWindow.focus(),
embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","false"),b.tabIndex="-1",b.setAttribute("aria-hidden","true"),b=R())b.inert=!0}else if(embeddedservice_bootstrap.filePreviewFrame.classList.remove("show"),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","true"),b.tabIndex="0",b.setAttribute("aria-hidden","false"),b=R())b.inert=!1;m("setFilePreviewFrameVisibility",`Full size file preview ${a?"shown":"hidden"}`)}}function Mb(a){let b;if(!f(a.attachmentDownloadURL))throw Error(`Invalid attachmentDownloadURL : ${a.attachmentDownloadURL}.`);
b=document.createElement("iframe");b.style.display="none";b.src=a.attachmentDownloadURL||"";document.body.appendChild(b);a.shouldOpenFileInNewTab&&window.open(b.src,"_blank","noreferrer noopener");setTimeout(()=>{document.body.removeChild(b)},1E3)}function kb(a){return new Promise((b,c)=>{let d=G(),e=document.createElement("link");e.id="embeddedMessagingBootstrapStyles";e.class="embeddedMessagingBootstrapStyles";e.href=d+"/assets/styles/bootstrap"+(embeddedservice_bootstrap.settings.devMode?"":".min")+
".css";e.type="text/css";e.rel="stylesheet";e.onerror=c;e.onload=b;document.getElementsByTagName("head")[0].appendChild(e)})}function lb(){return Ka(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v1/embedded-service-config?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName+"&language="+embeddedservice_bootstrap.settings.language,"GET","getConfigurationData")}function La(){return Ka(embeddedservice_bootstrap.settings.scrt2URL+
"/embeddedservice/v1/businesshours?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName,"GET","getBusinessHoursInterval").then(a=>{a=a&&a.businessHoursInfo;m("getBusinessHoursInterval","Successfully retrieved Business Hours data");a&&Array.isArray(a.businessHours)&&0<a.businessHours.length&&(P={startTime:a.businessHours[0].startTime,endTime:a.businessHours[0].endTime},Ma())}).catch(a=>{throw a;})}function mb(a){k("handleBusinessHoursError",
"Failed to retrieve Business Hours data. Retrying the request.",a);return La()}function va(){if(embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl){const a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl+(embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===Na.AURA?"":"vforcesite")+"/_nc_external/system/security/session/SessionTimeServlet?buster="+(new Date).getTime();return Ka(a,"GET","getExpSiteSessionTimeout").then(b=>{try{b=JSON.parse(b.substring(b.indexOf("{"),
b.indexOf("}")+1))}catch(c){k("getExpSiteSessionTimeout","Error parsing response text from server ",c)}"number"===typeof b.sr&&(m("getExpSiteSessionTimeout","Successfully retrieved experience site session timeout"),0<b.sr?(embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser=!1,Oa&&clearTimeout(Oa),Oa=setTimeout(()=>{va()},1E3*b.sr)):(embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser=!0,embeddedservice_bootstrap.userVerificationAPI.clearSession()))})}}function Ka(a,
b,c){const d=performance.now();return new Promise((e,l)=>{const n=new XMLHttpRequest;n.open(b,a,!0);n.onreadystatechange=g=>{if((g=g.target)&&g.readyState===g.DONE||204===g.status){const J=((performance.now()-d)/1E3).toFixed(3);if(200===g.status||204===g.status)if("getExpSiteSessionTimeout"!==c){const M=g.responseText?JSON.parse(g.responseText):g.responseText;e(M)}else e(g.responseText);else l(g.status);m("sendXhrRequest",`${c?c:a} took ${J} seconds and returned with the status code ${g.status}`)}};
n.send()})}function Qb(){return O()?nb().then(a=>wa().then(b=>{m("initializeConversationState","finished joining verified user conversation");fa(a,b)}).catch(()=>{L()})):w()===x.UNAUTH?ob()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?(fa(),Promise.resolve()):Pa().then(a=>ha(N).then(b=>{m("initializeConversationState","finished creating conversation");fa(a,b)}).catch(()=>{L()})):Promise.reject(Error("Something went wrong initializing conversation state."))}
function pb(a){fa(null,null,a);return Promise.resolve()}function fa(a,b,c,d=!1){var e=q(C.FAILED_OUTBOUND_MESSAGE_ENTRIES,!1);const l=embeddedservice_bootstrap.settings.standardLabels,n=embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels;if(embeddedservice_bootstrap.settings.imageCompressionOptions){var g=embeddedservice_bootstrap.settings.imageCompressionOptions;g=Object.assign({},g.quality&&!isNaN(Number(g.quality))&&0<=Number(g.quality)&&1>=Number(g.quality)&&{quality:Number(g.quality)},
g.maxHeight&&!isNaN(Number(g.maxHeight))&&0<Number(g.maxHeight)&&{maxHeight:Number(g.maxHeight)},g.maxWidth&&!isNaN(Number(g.maxWidth))&&0<Number(g.maxWidth)&&{maxWidth:Number(g.maxWidth)},g.convertTypes&&("string"===typeof g.convertTypes||Array.isArray(g.convertTypes))&&{convertTypes:g.convertTypes},g.convertSize&&!isNaN(Number(g.convertSize))&&0<=Number(g.convertSize)&&{convertSize:g.convertSize})}g=Object.assign({},g&&{imageCompressionOptions:g},"boolean"===typeof embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot&&
{enableUserInputForConversationWithBot:!!embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot},"boolean"===typeof embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist&&{shouldShowParticipantChgEvntInConvHist:!!embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist},{shouldMinimizeWindowOnNewTab:embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab});e=Object.assign({},embeddedservice_bootstrap.settings.embeddedServiceConfig,Object.assign({},
{identityToken:F,failedMessages:e,conversationId:z,devMode:!!embeddedservice_bootstrap.settings.devMode,noSsePatch:!!embeddedservice_bootstrap.settings.noSsePatch,language:embeddedservice_bootstrap.settings.language},l&&{standardLabels:l},n&&{customLabels:n},{hasConversationButtonColorContrastMetA11yThreshold:qb.isValidContrastRatio("#FFFFFF",U("headerColor")),hostUrl:window.location.href},w()===x.EXP_SITE_AUTH&&{expSiteUrl:embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl},embeddedservice_bootstrap.settings.displayMode&&
{displayMode:embeddedservice_bootstrap.settings.displayMode},{snippetSettings:g,capabilitiesVersion:"254"}))||{};a&&(e=Object.assign(e,{jwtData:a}));b&&(e=Object.assign(e,{conversationData:b}));c&&(e=Object.assign(e,{errorData:c}));e.isExistingSessionOnPageLoad=d;r("ESW_SET_CONFIG_EVENT",e)}function Nb(a){const b=Object.assign(a,N);y("onEmbeddedMessagingPreChatSubmitted",{detail:{prechatDisplay:Rb.CONVERSATION}});O()?wa().then(c=>{c&&c.isExistingConversation?(m("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the verified user. Joining the existing conversation."),
r("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",c)):(m("handlePrechatSubmit","Pre-chat submitted. Creating a new conversation."),ha(b).then(d=>{r("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)}))}):w()===x.UNAUTH&&(q(C.JWT)?(m("handlePrechatSubmit","Pre-chat submitted but a JWT exists in web storage. Fetching existing conversations."),K=q(C.JWT),rb().then(c=>{r("ESW_SET_JWT_EVENT",c);wa().then(d=>{d&&d.isExistingConversation?(m("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the unverified user. Joining the existing conversation."),
r("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)):(m("handlePrechatSubmit","Pre-chat submitted and no existing conversations found. Creating a new conversation."),ha(b).then(e=>{r("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",e)}))})})):(m("handlePrechatSubmit","Pre-chat submitted. Fetching a JWT and starting a new conversation."),Pa().then(c=>{r("ESW_SET_JWT_EVENT",c);ha(b).then(d=>{r("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)})})))}function sb(){return new Promise(a=>{embeddedservice_bootstrap.createFilePreviewFrame();
embeddedservice_bootstrap.createIframe().then(()=>{a("Created Embedded Messaging frame.")})})}function rb(){return q(C.JWT)?Sb().then(a=>{ra(a.accessToken);m("handleGetContinuityJwt","Sucessfully retreived a Continuity JWT");return a}).catch(a=>{k("handleGetContinuityJwt",`Failed to get Continuity JWT: ${a&&a.message?a.message:a}.`);T()}):Promise.reject(void 0)}function Sb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/continuityAccessToken");return V(a,
"GET","cors",null,null,"getContinuityJwt").then(b=>{if(!b.ok)throw b;return b.json()})}function Pa(){return Tb().then(a=>{ra(a.accessToken);m("handleGetUnauthenticatedJwt","Successfully retreived an Unauthenticated JWT");return a}).catch(a=>Ub(a))}function Tb(){const a=embeddedservice_bootstrap.settings.orgId,b=embeddedservice_bootstrap.settings.eswConfigDevName;var c=tb();c=c?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken","?",c):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken");
return V(c,"POST","cors",{"Content-Type":"application/json"},{orgId:a,developerName:b,capabilitiesVersion:"254"},"getUnauthenticatedJwt").then(d=>{if(!d.ok)throw d;return d.json()})}function nb(){return(w()===x.EXP_SITE_AUTH?Vb():Wb()).then(a=>{a=w()===x.EXP_SITE_AUTH?a.data:a;ra(a.accessToken);m("handleGetAuthenticatedJwt","Successfully retreived an Authenticated JWT");return a}).catch(a=>{a=(null==a?void 0:a.message)||a;k("handleGetAuthenticatedJwt",`Error retrieving authenticated token: ${a}.`);
gb();throw a;})}function Vb(){const a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl+"/miaw/auth/accesstoken"+`?platformType=${"Web"}&developerName=${embeddedservice_bootstrap.settings.eswConfigDevName}&capabilitiesVersion=${"254"}`,b={Cos:"0x0204","Content-Type":"application/json"};return ia(a,"GET","cors",b,null,"getExpSiteAuthenticatedJwt").then(c=>{if(!c.ok)throw c;return c.json()}).catch(c=>xa(c,a,"GET","cors",b,null,"getExpSiteAuthenticatedJwt"))}function Wb(){const a=embeddedservice_bootstrap.settings.orgId,
b=embeddedservice_bootstrap.settings.eswConfigDevName,c=F,d=tb(),e=d?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken","?",d):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken"),l={"Content-Type":"application/json"},n={orgId:a,developerName:b,capabilitiesVersion:"254",authorizationType:Qa.JWT,customerIdentityToken:c};return c&&ua(c)?ia(e,"POST","cors",l,n,"getAuthenticatedJwt").then(g=>
{if(!g.ok)throw g;return g.json()}).catch(g=>xa(g,e,"POST","cors",l,n,"getAuthenticatedJwt")):(new Promise(g=>{ub({apiPath:e,method:"POST",mode:"cors",requestHeaders:l,requestBody:n,resolve:g})})).then(g=>{if(!g.ok)throw g;return g.json()})}function Xb(){Yb().then(()=>{m("handleRegisterDeviceCapabilities","Successfully Registered Device Capabilities.")})}function Yb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/device/registerDeviceCapabilities");return V(a,"POST","cors",
null,{},"registerDeviceCapabilities")}function wa(a){return Zb(!1,embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel?embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier:null).then(b=>{let c=[];if(!b.conversations||!Array.isArray(b.conversations))throw Error(`Invalid conversation list: ${b.conversations}.`);c=b.conversations.filter(d=>0===d.endTimestamp);if(0===c.length){if(a)throw t("handleListConversation","No open conversation found, deleting stale data from web storage.",
!0),T(),Error("No open conversation found for JWT in web storage.");return ob()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?null:(t("handleListConversation","No existing conversation found and pre-chat is not enabled. Will start a new conversation."),ha(N).then(d=>d))}1<c.length&&(t("handleListConversation",`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),
c.sort((d,e)=>e.startTimestamp-d.startTimestamp));b=c[0];if(!$b(b.conversationId))throw Error(`Invalid conversation identifier: ${b.conversationId}.`);m("handleListConversation","Successfully retrieved existing conversation");z!==b.conversationId&&(m("handleListConversation",`ConversationId change detected. Old conversation-id: ${z} & New conversation-id: ${b.conversationId}`),z=b.conversationId);b.isExistingConversation=!0;return b}).catch(b=>{k("handleListConversation",`Failed to list conversation entries: ${b&&
b.message?b.message:b}.`);throw Error(`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);})}function Zb(a,b){const c=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/queries/conversation/list");return V(c,"POST","cors",null,Object.assign({},{includeClosedConversations:a},b&&{channelAddressIdentifier:b}),"listConversation").then(d=>d.json())}function Ub(a){if(a&&a.status&&401===a.status)return k("handleGetJwtError","Unauthorized error caused by JWT expiration. Attempt to get another JWT",
a.status),Pa().catch(b=>{throw Error(b);});throw Error(`Error retrieving unauthenticated token: ${a}.`);}function ob(){return(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms||[]).some(a=>{a.formFields=a.formFields||[];return"PreChat"===a.formType&&0<a.formFields.length})}function ha(a){if(Fa)return k("handleCreateNewConversation","Attempting to create new conversation multiple times!",null,!0),Promise.resolve();if(a)if("object"===typeof a)for(const [b,c]of Object.entries(a))m("handleCreateNewConversation",
`Pre-chat field: ${b} ${c&&0<c.trim().length?`is set with a value of ${c.length} characters.`:"is not set."}`);else k("handleCreateNewConversation",`Expected to receive a valid object for Pre-Chat fields, instead received ${typeof a}`);Fa=!0;return ac(a).then(b=>{y("onEmbeddedMessagingConversationStarted",{detail:{conversationId:z}});Xb();b.esDeveloperName=embeddedservice_bootstrap.settings.eswConfigDevName;m("handleCreateNewConversation",`Initialized the esDeveloperName associated with current conversation to: ${embeddedservice_bootstrap.settings.eswConfigDevName}`);
return b})}function ac(a){const b=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation");return V(b,"POST","cors",null,Object.assign({},a&&{routingAttributes:a},{conversationId:z}),"createNewConversation").then(c=>c.json())}function bc(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation","/",z,"/transcript");return V(a,"GET","cors",null,null,"getTranscript").then(b=>b.arrayBuffer())}function Ob(){y("onEmbeddedMessagingTranscriptRequested",
{detail:{conversationId:z}});bc().then(a=>{a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);const b=document.createElement("a");b.href=a;b.download="ConversationTranscript.pdf";b.click();window.URL.revokeObjectURL(a);r("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_SUCCESS_EVENT");y("onEmbeddedMessagingTranscriptDownloadSuccessful",{detail:{conversationId:z}})}).catch(a=>{if(a){const b=a.status;a=a.message||void 0;r("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",{detail:{errorCode:b,
errorMessage:a}});k("handleRequestTranscript",`Transcript request failed with status code: ${b} & message: ${a}`,b)}else r("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT");y("onEmbeddedMessagingTranscriptRequestFailed",{detail:{conversationId:z}})})}function ia(a,b,c,d,e,l=a){d=d?d:Object.assign({},{"Content-Type":"application/json"},K&&{Authorization:"Bearer "+K});e=e?JSON.stringify(e):void 0;const n=performance.now();return fetch(a,Object.assign({},{method:b,mode:c,headers:d},e&&{body:e})).then(g=>
$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const J=((performance.now()-n)/1E3).toFixed(3);m("sendFetchRequest",`${l} took ${J} seconds and returned with the status code ${g.status}`);if(!g.ok){let M;try{M=Object.assign(g,yield g.json())}catch(qc){M=Object.assign(g,{message:`Error reading the body stream of error object: ${g}`})}throw M;}return g}))}function xa(a,b,c,d,e,l,n=b){if(!a||!a.status||500<=a.status&&599>=a.status)return k("handleSendFetchRequestError",`Something went wrong in ${n}: ${a&&
a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}. Re-trying the request.`,a&&a.status),ia(b,c,d,e,l,n).catch(g=>{k("handleSendFetchRequestError",`${n} request failed again: ${g&&g.message?g.message:JSON.stringify(Object.assign({},g,{status:g.status,statusText:g.statusText,type:g.type}))}.`,g&&g.status);throw g;});if(401===a.status){k("handleSendFetchRequestError",`${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,
statusText:a.statusText,type:a.type}))}.`,a&&a.status);if(w()===x.UNAUTH)throw H(),a;if(O())return F&&ua(F)||w()===x.EXP_SITE_AUTH?new Promise(g=>{vb({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:l,resolve:g})}):new Promise(g=>{ub({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:l,resolve:g})})}else if(423===a.status){const g={};Object.assign(g,{errorStatus:a.status,errorCode:a.errorCode});if(a.errorCode&&"ORG_UNDER_MAINTENANCE"===a.errorCode||"ORG_NOT_SUPPORTED"===a.errorCode)k("handleSendFetchRequestError",
`Received a ${a.status} in ${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status),S?r("EMBEDDED_MESSAGING_CONVO_ERROR_DATA_RECEIVED",g):pb(g)}else throw k("handleSendFetchRequestError",`Something went wrong in ${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status),a;}function V(a,b,c,d,e,l){return ia(a,b,c,d,e,l).catch(n=>xa(n,a,b,c,d,e,
l))}function tb(){let a="";const b=Ra();b&&(a=(new URLSearchParams({os:b.os.name,osVersion:b.os.version,browser:b.browser.name,browserVersion:b.browser.version})).toString());return a}function Ra(){var a=[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera].join(" ");const b=wb(a,[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},
{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}]);a=wb(a,[{name:"Edge",value:"Edg",version:"Edg"},{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",
version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}]);return{os:b,browser:a}}function wb(a,b){let c;let d;for(c=0;c<b.length;c+=1){var e=new RegExp(b[c].value,"i");if(e=e.test(a)){e=new RegExp(b[c].version+"[- /:;]([\\d._]+)","i");e=a.match(e);d="";e&&e[1]&&(e=e[1]);if(e)for(e=e.split(/[._]+/),a=0;a<e.length;a+=1)d=0===a?d+(e[a]+"."):
d+e[a];else d="0";return{name:b[c].name,version:parseFloat(d)}}}return{name:"unknown",version:0}}function G(){try{return embeddedservice_bootstrap.settings.siteURL}catch(a){k("getSiteURL",`Error getting Site URL: ${a}`)}}function D(a,b){for(const c of embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||"";for(const c of embeddedservice_bootstrap.settings.standardLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||
"";return""}function U(a){for(const b of embeddedservice_bootstrap.brandingData)if(b.n&&b.n===a)return b.v}function cc(){const a=embeddedservice_bootstrap.settings.chatButtonPosition;if("string"===typeof a&&0<a.length){const b=a.split(",");2!==b.length?k("setButtonPositionStyles",`Invalid embeddedservice_bootstrap.settings.chatButtonPosition value specified: ${a}. Valid format is "25px, 30px".`):(document.documentElement.style.setProperty("--eswButtonBottom",b[0].trim()),document.documentElement.style.setProperty("--eswButtonRight",
b[1].trim()))}}function xb(){let a=A(),b=document.getElementById("embeddedMessagingIconContainer"),c=document.getElementById("embeddedMessagingIconChat"),d=document.createElement("div"),e=document.createElement("span"),l,n=1;if(a){c.style.display="none";d.setAttribute("class","embeddedMessagingLoadingSpinner");for(d.setAttribute("id","embeddedMessagingLoadingSpinner");13>n;n++)l=document.createElement("div"),l.setAttribute("class","embeddedMessagingLoadingCircle"+n+" embeddedMessagingLoadingCircle"),
d.appendChild(l);d.classList.add("embeddedMessagingIconLoading");a.classList.add("embeddedMessagingConversationButtonLoading");b.insertBefore(d,c);a.disabled=!0;e.className="slds-assistive-text";e.setAttribute("role","alert");e.innerHTML=D("EmbeddedMessagingPrechat","PrechatSubmitButtonLoading")||"Loading";d.appendChild(e)}}function Sa(){return-1===navigator.userAgent.indexOf("Mobi")}function ta(){if(!P)return!0;const a=Number(P.startTime),b=Number(P.endTime),c=Date.now();return c>=a&&c<b?!0:!1}function Ma(){let a;
if(P){var b=ta();b?a=Number(P.endTime):(a=Number(P.startTime),y("onEmbeddedMessagingBusinessHoursEnded"));isNaN(a)||(ja&&clearTimeout(ja),ja=setTimeout(()=>{clearTimeout(ja);ja=void 0;dc(b);b?y("onEmbeddedMessagingBusinessHoursEnded"):y("onEmbeddedMessagingBusinessHoursStarted")},a-Date.now()))}}function dc(a){a?(P=void 0,embeddedservice_bootstrap.utilAPI.hideChatButton(),La().then(Ma()).catch(b=>mb(b))):(ka()||embeddedservice_bootstrap.utilAPI.showChatButton(),Ma())}function ec(){const a=!!navigator.userAgent.match(/iP(hone|ad|od)/i);
var b=navigator.userAgent.match(/(?!=OS)(([0-9]){2})/i);b=b&&0<b.length?Number(b[0]):-1;const c=!!navigator.userAgent.match(/WebKit/i)&&!navigator.userAgent.match(/CriOS/i);return a&&c&&15<=b}function ka(){try{return embedded_svc&&embedded_svc.menu?!0:!1}catch(a){return!1}}function ya(){return embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===Na.LWR||embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===Na.AURA}function za(){return embeddedservice_bootstrap.settings.displayMode===
yb.INLINE}function Ta(a){const b=embeddedservice_bootstrap.settings.targetElement.children;let c;for(const d in b)c=b[d],c!==R()&&c!==embeddedservice_bootstrap.filePreviewFrame&&(c.inert=a)}function Pb(a){const b=document.getElementById("embeddedMessagingLiveRegion");b.textContent=a.text;la&&clearTimeout(la);la=setTimeout(()=>{b.textContent=""},3E3)}function zb(){const a=document.querySelector('meta[name="viewport"]');a&&(a.setAttribute("content",W),W=void 0)}function r(a,b){Da.then(()=>{const c=
embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),G()):t("sendPostMessageToAppIframe",`Embedded Messaging iframe not available for post message with method ${a}.`)})}function Y(a,b){fc.then(()=>{const c=embeddedservice_bootstrap.siteContextFrame;if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);
c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),G()):t("sendPostMessageToSiteContextIframe",`Embedded Messaging site context iframe not available for post message with method ${a}.`)})}function Ab(){Y("ESW_PREFETCH_LWR_RESOURCES")}function gc(a){a||k("handleAuraSite","Failed to load aura app. Iframe is undefined.");a.src=G()+"/embeddedService/embeddedService.app"}function hc(a){let b=G();a||k("handleLWRSite","Failed to load LWR site. Iframe is undefined.");
b.endsWith("/")||(b+="/");a.src=b+"?lwc.mode="+(embeddedservice_bootstrap.settings.devMode?"dev":"prod")}function ib(){return new Promise((a,b)=>{try{let c=A(),d=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if(c&&!c.classList.contains("embeddedMessagingConversationButtonLoaded")){if(q(C.JWT))return m("handleClick","Conversation button clicked but a JWT exists in web storage. Joining the existing conversation."),K=q(C.JWT),Bb(!1).then(()=>{a()}).catch(e=>{L();k("handleClick",e.message);
b(e)});E(C.CONVERSATION_BUTTON_CLICK_TIME,Date.now(),!0,!0);xb();m("handleClick","Conversation button clicked");sb().then(()=>{a()}).catch(e=>{k("handleClick",e.message);b(e)});(embeddedservice_bootstrap.settings.embeddedServiceConfig.fallbackMessage||{}).isFallbackMessageEnabled?pb():Qb().catch(e=>{L();k("handleClick",e.message);b(e)})}else c&&c.classList.contains("embeddedMessagingConversationButtonLoaded")&&d&&d.classList&&d.classList.contains("isMaximized")?r("ESW_APP_MINIMIZE"):k("handleClick",
"Something went wrong handling button click event.")}catch(c){b(c)}})}function ic(a){let b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();a&&a.key&&(a.key===ma.SPACE||a.key===ma.ENTER?(a.preventDefault(),hb()):a.key===ma.TAB&&a.shiftKey&&b&&b.classList&&b.classList.contains("isMaximized")&&(a.preventDefault(),r("trapfocustolast")))}function jc(){const a=document.getElementById("embeddedMessagingMinimizedNotification"),b=A();a&&a.parentNode.removeChild(a);b&&b.focus()}function kc(a){if(a.key===
ma.ENTER||a.key===ma.SPACE)a.preventDefault(),this.handleNotificationDimissButtonClick()}function Bb(a){if(q(C.JWT))return xb(),sb().catch(k),rb().then(b=>{wa(a).then(c=>{fa(b,c,null,a)})}).catch(k)}function T(a){m("resetClientToInitialState","Resetting client to initial state.");try{H(a),Ib(),p()}catch(b){k("resetClientToInitialState",`Error on clearing web storage for the previously ended conversation: ${b}`)}W&&zb();Ua.test(navigator.userAgent)&&Ta(!1);embeddedservice_bootstrap.removeMarkup();
if(w()===x.UNAUTH||w()===x.EXP_SITE_AUTH&&!embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser)w()===x.EXP_SITE_AUTH&&va(),embeddedservice_bootstrap.generateMarkup(),A()&&A().focus();la&&clearTimeout(la);m("resetClientToInitialState","Successfully reset client to initial state.");na&&"function"===typeof na&&(na(),m("resolveClearSessionPromise","Resolved Clear Session promise."),na=void 0)}function lc(){const a=document.createElement("div");a.id="embeddedMessagingModalOverlay";return a}
function qa(a,b){a&&Aa.currentStateLogs.push(a);b&&Aa.errorLogs.push(b);Da.then(()=>{r("EMBEDDED_MESSAGING_PUSH_PARENT_FRAME_LOGS",{pendingLogs:Aa});Ya()})}function Ya(){Aa={currentStateLogs:[],errorLogs:[]}}function Va(){}function Ja(a,b,c=!1){embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()?r("EMBEDDED_MESSAGING_CLEAR_USER_SESSION_EVENT",{shouldRevokeJwt:a,shouldEndSession:c}):T(b)}function vb(a){return new Promise(b=>{m("renewAuthenticatedJwt","Renewing Authenticated JWT");nb().then(()=>
{Cb(a);b()})})}function Cb(a){a&&ia(a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody).then(b=>{a.resolve&&"function"===typeof a.resolve&&a.resolve(b)}).catch(b=>xa(b,a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody))}function ub(a){if(a){y("onEmbeddedMessagingIdentityTokenExpired");var b=new Promise(d=>{oa=d}),c=new Promise((d,e)=>{setTimeout(()=>{e()},3E4)});Promise.race([b,c]).then(()=>{m("handleIdentityTokenExpiry","Valid identity token found. Fetch authenticated JWT.");a.apiPath.includes("/accessToken")?
(a.requestBody.customerIdentityToken=F,Cb(a)):vb(a)}).catch(()=>{k("handleIdentityTokenExpiry","Failed to fetch authenticated JWT due to setIdentityToken timeout or other error. Clearing the messaging session on all tabs.");Ja(!1,!1)})}}function gb(){let a;T(!1);embeddedservice_bootstrap.generateMarkup();a=A();var b=document.getElementById("embeddedMessagingIconChat");var c=document.getElementById("embeddedMessagingIconContainer");if(a){a.style.display="block";a.setAttribute("tabindex",-1);a.style.setProperty("cursor",
"default");a.classList.add("no-hover");c&&b&&c.removeChild(b);b=Ia(Ba.REFRESH);b.setAttribute("id","embeddedMessagingIconRefresh");b.setAttribute("class","embeddedMessagingIconRefresh");c.appendChild(b);c=document.createElement("div");b=document.createElement("div");const e=document.createElement("span"),l=document.createElement("span");var d=document.createElement("button");const n=document.createElement("span"),g=document.createElement("span");d.className="embeddedMessagingMinimizedNotificationDismissButton";
d.addEventListener("click",jc);d.addEventListener("keydown",kc);d.setAttribute("aria-describedby","dismissButton-help");n.className="embeddedMessagingMinimizedNotificationDismissButtonText";n.title=D("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";n.innerHTML=D("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";n.style.setProperty("font-family",U("font"));g.className="slds-assistive-text";g.id="dismissButton-help";g.innerHTML=D("EmbeddedMessagingMinimizedState",
"MinimizedNotificationDismissButtonAssistiveText")||"Close the chat notification";d.appendChild(n);d.appendChild(g);c.id="embeddedMessagingMinimizedNotification";c.className="embeddedMessagingMinimizedNotification";b.className="embeddedMessagingMinimizedNotificationTextWrapper";e.className="embeddedMessagingMinimizedNotificationText";e.role="status";e.title=D("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";
e.innerHTML=D("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";e.style.setProperty("font-family",U("font"));l.className="slds-assistive-text";l.innerHTML=D("EmbeddedMessagingMinimizedState","MinimizedNotificationAssistiveText")||"Expand the text.";b.appendChild(e);b.appendChild(l);c.appendChild(b);c.appendChild(d);a.disabled=!0;embeddedservice_bootstrap.settings.targetElement.appendChild(c)}}function Db(a){a=
a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");a=decodeURIComponent(window.atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}function ua(a){let b,c;if(!a)return embeddedservice_bootstrap.settings.devMode&&m("validateJwt","Empty jwt parameter passed in - skipping validation."),!1;try{return b=Db(a),c=Math.floor(Date.now()/1E3)<b.exp,embeddedservice_bootstrap.settings.devMode&&!c&&m("validateJwt",`JWT has expired at ${(new Date(1E3*
b.exp)).toString()}`),c}catch(d){return embeddedservice_bootstrap.settings.devMode&&k("validateJwt",`JWT validation failed: ${d.message}`),!1}}function w(){let a=null;try{a=embeddedservice_bootstrap.settings.embeddedServiceConfig&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode}catch(b){k("getAuthMode",`Failed to retrieve auth mode flag: ${b.message}`)}return a}
function O(){return w()===x.AUTH||w()===x.EXP_SITE_AUTH}function pa(){}function Eb(a,b,c,d){const e="setHiddenPrechatFields"===a;var l=e?mc():X();const n=l.map(({name:g})=>g);l=l.find(g=>g.name===b);return n.includes(b)?"string"===typeof c&&(c.toLowerCase().includes("javascript:")||c.toLowerCase().includes("<script>"))?(k("validatePrechatField",`JavaScript isn't allowed in the value for the ${b} field when calling ${a}.`),!1):c&&String(c).length>l.maxLength?(k("validatePrechatField",`Value for the ${b} field in ${a} exceeds the maximum length restriction of ${l.maxLength} characters.`),
!1):e&&"string"!==typeof c?(k("validatePrechatField",`You must specify a string for the ${b} field in ${a} instead of a ${typeof c} value.`),!1):d&&"boolean"!==typeof d?(k("validatePrechatField","setVisiblePrechatFields was called with isEditableByEndUser set to a value that\u2019s not boolean. Enter a boolean value."),!1):!0:(k("validatePrechatField",`${a} called with an invalid field name ${b}.`),!1)}function mc(){let a=[];var b=Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&
embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields)?!0:!1;b&&(a=embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields);return a}function X(){return Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields)&&
embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields.length?embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields:[]}function Ca(a){return I?!0:(k("shouldProcessPrechatFieldsFromHost",`Can't call ${a} before the onEmbeddedMessagingReady event is fired.`),!1)}function $b(a){return"string"===typeof a&&0<a.trim().length?!0:!1}function Jb(){X().forEach(a=>{delete a.value;delete a.isEditableByEndUser})}function Wa(){}function Fb(a){return I?!0:(k("shouldProcessAutoResponseParametersFromHost",
`[${a}] Cannot invoke Auto-Response API before the onEmbeddedMessagingReady event is fired.`),!1)}function Q(){}function B(){this.settings={devMode:!1,targetElement:document.body};this.isSessionStorageAvailable=this.isLocalStorageAvailable=!0;Object.defineProperties(Ba,{CHAT:{value:"M50 0c27.614 0 50 20.52 50 45.833S77.614 91.667 50 91.667c-8.458 0-16.425-1.925-23.409-5.323-13.33 6.973-21.083 9.839-23.258 8.595-2.064-1.18.114-8.436 6.534-21.767C3.667 65.54 0 56.08 0 45.833 0 20.52 22.386 0 50 0zm4.583 61.667H22.917a2.917 2.917 0 000 5.833h31.666a2.917 2.917 0 000-5.833zm12.5-15.834H22.917a2.917 2.917 0 000 5.834h44.166a2.917 2.917 0 000-5.834zM79.583 30H22.917a2.917 2.917 0 000 5.833h56.666a2.917 2.917 0 000-5.833z"},
MINIMIZE_MODAL:{value:"M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2 c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"},REFRESH:{value:"M46.5,4h-3C42.7,4,42,4.7,42,5.5v7c0,0.9-0.5,1.3-1.2,0.7l0,0c-0.3-0.4-0.6-0.7-1-1c-5-5-12-7.1-19.2-5.7 c-2.5,0.5-4.9,1.5-7,2.9c-6.1,4-9.6,10.5-9.7,17.5c-0.1,5.4,2,10.8,5.8,14.7c4,4.2,9.4,6.5,15.2,6.5c5.1,0,9.9-1.8,13.7-5 c0.7-0.6,0.7-1.6,0.1-2.2l-2.1-2.1c-0.5-0.5-1.4-0.6-2-0.1c-3.6,3-8.5,4.2-13.4,3c-1.3-0.3-2.6-0.9-3.8-1.6 C11.7,36.6,9,30,10.6,23.4c0.3-1.3,0.9-2.6,1.6-3.8C15,14.7,19.9,12,25.1,12c4,0,7.8,1.6,10.6,4.4c0.5,0.4,0.9,0.9,1.2,1.4 c0.3,0.8-0.4,1.2-1.3,1.2h-7c-0.8,0-1.5,0.7-1.5,1.5v3.1c0,0.8,0.6,1.4,1.4,1.4h18.3c0.7,0,1.3-0.6,1.3-1.3V5.5 C48,4.7,47.3,4,46.5,4z"}});
this.brandingData=[]}function nc(){const a=document.createElement("iframe"),b=new URL(`${G()}/assets/htdocs/sitecontext${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);embeddedservice_bootstrap.settings.devMode&&b.searchParams.set("dev_mode",!0);a.classList.add("embeddedMessagingSiteContextFrame");a.id="embeddedMessagingSiteContextFrame";a.name="embeddedMessagingSiteContextFrame";a.src=b.href;a.onload=()=>{m("createSiteContextFrame",
"Created an iframe for siteContext.")};embeddedservice_bootstrap.siteContextFrame=a;document.body.appendChild(a)}const Ba={},x={AUTH:"Auth",UNAUTH:"UnAuth",EXP_SITE_AUTH:"ExperienceSiteAuth"},Rb={CONVERSATION:"Conversation",SESSION:"Session"},yb={INLINE:"inline",POPUP:"default"};class qb{static isValidContrastRatio(a,b,c=3){return this.getContrastRatio(a,b)>=c}static getContrastRatio(a,b){a=this.convertHexToRGB(a);b=this.convertHexToRGB(b);a=this.getRelativeLuminance(a);b=this.getRelativeLuminance(b);
return((Math.max(a,b)+.05)/(Math.min(a,b)+.05)).toFixed(2)}static getRelativeLuminance(a){const [b,c,d]=Object.values(a).map(e=>this.getSRGB(e));return.2126*b+.7152*c+.0722*d}static getSRGB(a){a/=255;return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}static convertHexToRGB(a){const b=parseInt(a.slice(1,3),16),c=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);return{r:b,g:c,b:a}}}const oc=".salesforce.com .force.com .sfdc.net .site.com .salesforce-sites.com .crm.dev".split(" "),Qa={JWT:"JWT"},
jb=document.title;let ea,Gb=!1,I=!1,S=!1,aa=!1,Ga=!1,Fa=!1,N={},Z={},K,F,v,z,Ea,Da=new Promise(a=>{Ea=a}),db;const fc=new Promise(a=>{db=a});let eb,pc=new Promise(a=>{eb=a}),W,P,ja,Oa,la;const C={JWT:"JWT",FAILED_OUTBOUND_MESSAGE_ENTRIES:"FAILED_MESSAGES",CONVERSATION_BUTTON_CLICK_TIME:"CONVERSATION_BUTTON_CLICK_TIME"},ma={ENTER:"Enter",TAB:"Tab",SPACE:" "},Ua=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,
Na={AURA:"AURA",LWR:"LWR"};let na,ca,ba,oa,Aa={currentStateLogs:[],errorLogs:[]},fb,Hb=new Promise(a=>{fb=a});B.prototype.removeEventHandlers=function(){window.removeEventListener("message",ab);window.removeEventListener("storage",bb)};B.prototype.emitEmbeddedMessagingReadyEvent=function(){I=!0;try{y("onEmbeddedMessagingReady")}catch(a){I=!1,k("emitEmbeddedMessagingReadyEvent",`Something went wrong in firing onEmbeddedMessagingReady event ${a}.`)}};B.prototype.removeMarkup=function(a){const b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame(),
c=A(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingMinimizedNotification"),l=R(),n=document.getElementById("inert-script");b?b.parentNode.removeChild(b):t("removeMarkup","Embedded Messaging iframe not available for resetting the client to initial state.");embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.parentNode?embeddedservice_bootstrap.filePreviewFrame.parentNode.removeChild(embeddedservice_bootstrap.filePreviewFrame):
t("removeMarkup","Embedded Messaging file preview iframe not available for resetting the client to initial state.");a&&embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.parentNode?embeddedservice_bootstrap.siteContextFrame.parentNode.removeChild(embeddedservice_bootstrap.siteContextFrame):t("removeMarkup","Embedded Messaging site context iframe not available for resetting the client to initial state.");d&&d.parentNode.removeChild(d);document.body.classList.contains("embeddedMessagingPreventScrolling")&&
(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));c?c.parentNode.removeChild(c):t("removeMarkup","Embedded Messaging static button not available for resetting the client to initial state.");e&&e.parentNode.removeChild(e);l&&l.parentNode.removeChild(l);n&&n.parentNode.removeChild(n);embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();sa()};Va.prototype.setIdentityToken=
function(a){let b;if(!I)return k("setIdentityToken","Method can\u2019t be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(w()!==x.AUTH)return k("setIdentityToken","User Verification isn\u2019t enabled in Messaging Settings."),!1;if(!a||null===a||"object"!==typeof a)return k("setIdentityToken","Invalid identity token parameter passed into the setIdentityToken method. Specify a valid object containing the token data."),!1;b=a.identityTokenType;a=a.identityToken;if("string"!==typeof b||
b.trim().toUpperCase()!==Qa.JWT)return k("setIdentityToken","Unsupported identity token. Only JWT-based identity tokens are supported."),!1;let c=!1;switch(b){case Qa.JWT:c=ua(a)}if(!c)return k("setIdentityToken","Invalid identity token passed into the setIdentityToken method."),!1;F=a;oa&&"function"===typeof oa&&(oa(),oa=void 0);m("setIdentityToken","Successfully set the customer identity token.");embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()?r("EMBEDDED_MESSAGING_SET_IDENTITY_TOKEN_EVENT",
F):A()?A()&&document.getElementById("embeddedMessagingIconRefresh")&&(embeddedservice_bootstrap.removeMarkup(),embeddedservice_bootstrap.generateMarkup()):embeddedservice_bootstrap.generateMarkup();return!0};Va.prototype.clearSession=function(a){return new Promise((b,c)=>{na=b;I?Ja(O(),!1,a):(c("Method can't be invoked before the onEmbeddedMessagingReady event is fired."),k("clearSession","Method cannot be invoked before the onEmbeddedMessagingReady event is fired."))})};pa.prototype.setHiddenPrechatFields=
function(a){if(Ca("setHiddenPrechatFields"))if(a&&"object"===typeof a)for(const [b,c]of Object.entries(a))Eb("setHiddenPrechatFields",b,c)&&(N[b]=c,m("setHiddenPrechatFields",`[setHiddenPrechatFields] Successfully updated Hidden Pre-Chat field ${b}.`));else k("setHiddenPrechatFields","When calling setHiddenPrechatFields, you must pass in an object with key-value pairs.")};pa.prototype.removeHiddenPrechatFields=function(a){Ca("removeHiddenPrechatFields")&&(a&&Array.isArray(a)?a.forEach(function(b){N.hasOwnProperty(b)?
(delete N[b],m("removeHiddenPrechatFields",`[removeHiddenPrechatFields] Successfully removed Hidden Pre-Chat field ${b}.`)):k("removeHiddenPrechatFields",`removeHiddenPrechatFields called with an invalid field name ${b}.`)}):k("removeHiddenPrechatFields","When calling removeHiddenPrechatFields, you must pass in an array of fields."))};pa.prototype.setVisiblePrechatFields=function(a){if(Ca("setVisiblePrechatFields")){var b=X();if(a&&"object"===typeof a&&!Array.isArray(a)){a=Object.entries(a);for(const [c,
d]of a)if(Eb("setVisiblePrechatFields",c,d.value,d.isEditableByEndUser)){const e=b.find(l=>l.name===c);e.value=d.value;"boolean"===typeof d.isEditableByEndUser&&(e.isEditableByEndUser=d.isEditableByEndUser);m("setVisiblePrechatFields",`[setVisiblePrechatFields] Successfully updated Visible Pre-Chat field ${c}.`)}a.length&&Hb.then(()=>{r("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",X())})}else k("setVisiblePrechatFields","setVisiblePrechatFields was called with an invalid object. Pass in an object with key-value pairs.")}};
pa.prototype.unsetVisiblePrechatFields=function(a){if(Ca("unsetVisiblePrechatFields")){var b=X();a&&Array.isArray(a)&&a.length?(a.forEach(c=>{const d=b.find(e=>e.name===c);d?(delete d.value,delete d.isEditableByEndUser,m("unsetVisiblePrechatFields",`[unsetVisiblePrechatFields] Successfully unset Visible Pre-Chat field ${c}.`)):k("unsetVisiblePrechatFields",`unsetVisiblePrechatFields was called with an invalid field name: ${c}. Enter a valid field name to remove.`)}),Hb.then(()=>{r("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",
X())})):k("unsetVisiblePrechatFields","When calling unsetVisiblePrechatFields, you must pass in an array of fields.")}};Wa.prototype.setAutoResponseParameters=function(a){if(Fb("setAutoResponseParameters"))if(a&&"object"===typeof a)for(const [c,d]of Object.entries(a)){a=c;var b=d;"string"!==typeof a||1>a.trim().length?(k("validateAutoResponseParameter",`Expected a non-empty string for the parameter name, but received ${typeof a}`),a=!1):"string"!==typeof b||1>b.trim().length?(k("validateAutoResponseParameter",
`Expected a non-empty string for the parameter value, but received ${typeof b}`),a=!1):a=!0;a?(Z[c]=d,m("setAutoResponseParameters",`[setAutoResponseParameters] Successfully updated auto-response parameter ${c}`)):t("setAutoResponseParameters",`[setAutoResponseParameters] Failed to validate auto-response parameter ${c}`)}else k("setAutoResponseParameters","[setAutoResponseParameters] Must pass in an object of parameters as key-value pairs.")};Wa.prototype.removeAutoResponseParameters=function(a){Fb("removeAutoResponseParameters")&&
(a&&Array.isArray(a)?a.forEach(function(b){Z.hasOwnProperty(b)?(delete Z[b],m("removeAutoResponseParameters",`[removeAutoResponseParameters] Successfully removed auto-response parameter ${b}`)):t("removeAutoResponseParameters",`[removeAutoResponseParameters] Failed to validate auto-response parameter ${b}`)}):k("removeAutoResponseParameters","[removeAutoResponseParameters] Must pass in an array of parameter names."))};Q.prototype.getEmbeddedMessagingFrame=function(){return document.getElementById("embeddedMessagingFrame")};
Q.prototype.prefetchResources=Ab;Q.prototype.showChatButton=function(){var a=w();if(!I)return k("showChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(a===x.UNAUTH||F){if(a=A())return a.style.display="block",!0;ka()&&sa(!0)}else k("showChatButton","Can't call showChatButton for a verified user before calling the setIdentity method with a valid token.");return!1};Q.prototype.hideChatButton=function(){if(!I)return k("hideChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),
!1;if(embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame())k("hideChatButton","Can\u2019t call hideChatButton once the messaging window is showing.");else{const a=A();if(a)return a.style.display="none",!0;ka()&&sa(!1)}return!1};Q.prototype.launchChat=function(){return new Promise((a,b)=>{let c;const d=()=>{let l;S||aa?(l="[Launch Chat API] Successfully initialized the messaging client.",m("launchChat",l),a(l),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",
e)):(l="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",t("launchChat",l),b(l))},e=()=>{let l;S||aa?(l="[Launch Chat API] Error launching the messaging client.",k("handleBootstrapError",l),b(l),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",e),T()):(l="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",t("launchChat",l),b(l))};
try{if(I){if(!A())if(ka()&&(!O()||O()&&F))embeddedservice_bootstrap.generateMarkup(!0);else{c="[Launch Chat API] Default chat button isn\u2019t present. Check if the messaging client initialized successfully.";t("launchChat",c);b(c);return}if(embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()){let l=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();l&&l.classList&&l.classList.contains("isMinimized")?(r("ESW_APP_MAXIMIZE"),m("launchChat","[Launch Chat API] Successfully maximized the messaging client."),
a("[Launch Chat API] Successfully maximized the messaging client.")):(c="[Launch Chat API] The messaging client window is already present and maximized.",t("launchChat",c),a(c))}else window.addEventListener("onEmbeddedMessagingInitSuccess",d),window.addEventListener("onEmbeddedMessagingInitError",e),ib().catch(l=>{c=`[Launch Chat API] Error when API simulates clicking the custom messaging client button: ${l}`;k("launchChat",c);b(c)})}else c="[Launch Chat API] Can\u2019t invoke API before the onEmbeddedMessagingReady event is fired.",
t("launchChat",c),b(c)}catch(l){c=`[Launch Chat API] Something went wrong launching the API: ${l}`,k("launchChat",c),b(c)}})};Q.prototype.sendTextMessage=function(a){return new Promise((b,c)=>{try{Ga?(ca=b,ba=c,r("EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_REQUEST",a)):(k("sendTextMessage","[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."),c("[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."))}catch(d){ba=
ca=void 0,b=`[Send Text Message API] Something went wrong sending text message: ${d}`,k("sendTextMessage",b),c(b)}})};Q.prototype.removeAllComponents=function(){return new Promise(a=>{embeddedservice_bootstrap.removeMarkup(!0);embeddedservice_bootstrap.removeEventHandlers();document.querySelector("#embeddedMessagingBootstrapStyles")&&document.querySelector("#embeddedMessagingBootstrapStyles").remove();const b=`${G()}/assets/js/bootstrap`+(embeddedservice_bootstrap.settings.devMode?"":".min")+".js";
document.body.querySelector(`script[src="${b}"]`)&&document.body.querySelector(`script[src="${b}"]`).remove();m("removeAllComponents","Successfully removed all components.");delete window.embeddedservice_bootstrap;a()})};B.prototype.isValidEntityId=function(a){return"string"===typeof a&&(18===a.length||15===a.length)};B.prototype.getKeyPrefix=function(a){if(embeddedservice_bootstrap.isValidEntityId(a))return a.substr(0,3)};B.prototype.isOrganizationId=function(a){return"00D"===embeddedservice_bootstrap.getKeyPrefix(a)};
B.prototype.isMessageFromSalesforceDomain=function(a){var b=a.split(":")[1].replace("//","");if(ya()&&b===document.domain)return!0;var c=function(d,e){return-1!==d.indexOf(e,d.length-e.length)};return oc.some(function(d){return c(b,d)})};B.prototype.generateMarkup=function(a=!1){var b=document.createDocumentFragment(),c=R(),d=A();if(ka()&&!a)sa();else if(!c||!d){c=document.createElement("div");c.id="embedded-messaging";c.className="embedded-messaging"+(za()?`-${yb.INLINE}`:"");a=document.createElement("div");
d=document.createElement("button");qb.isValidContrastRatio("#FFFFFF",U("headerColor"))||document.documentElement.style.setProperty("--eswIconFillColor","#1A1B1E");var e=document.createElement("div");const l=Ia(Ba.CHAT);l.setAttribute("id","embeddedMessagingIconChat");l.setAttribute("class","embeddedMessagingIconChat");e.id="embeddedMessagingIconContainer";e.className="embeddedMessagingIconContainer";e.appendChild(l);a.className="embeddedMessagingConversationButtonWrapper";d.classList.add("embeddedMessagingConversationButton");
d.id="embeddedMessagingConversationButton";d.href="javascript:void(0)";d.addEventListener("click",hb);d.addEventListener("keydown",ic);d.setAttribute("tabindex",0);d.setAttribute("role","button");d.setAttribute("aria-label",D("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.setAttribute("title",D("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.style.setProperty("--eswHeaderColor",U("headerColor"));
d.style.setProperty("--eswSecondaryColor",U("secondaryColor"));embeddedservice_bootstrap.settings.hasBottomTabBar&&d.classList.add("embeddedMessagingBottomTabBar");if((!ta()||embeddedservice_bootstrap.settings.hideChatButtonOnLoad)&&!q(C.JWT)||za())d.style.display="none";embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());
ya()&&d.classList.add("eswExperienceSite");d.appendChild(e);a.appendChild(d);d=a;b.appendChild(c);c.appendChild(d);embeddedservice_bootstrap.settings.targetElement.appendChild(b);try{y("onEmbeddedMessagingButtonCreated",{detail:{buttonVisibility:ta()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad||q(C.JWT)?"Show":"Hide"}})}catch(n){k("onEmbeddedMessagingButtonCreated",`Something went wrong in firing onEmbeddedMessagingButtonCreated event ${n}.`)}document.getElementById("inert-script")||
(b=document.createElement("script"),c=`${G()}/assets/js/inert${embeddedservice_bootstrap.settings.devMode?"":".min"}.js`,b.id="inert-script",b.type="text/javascript",b.src=c,embeddedservice_bootstrap.settings.targetElement.appendChild(b));b=document.createElement("div");b.id="embeddedMessagingLiveRegion";b.setAttribute("aria-live","assertive");b.setAttribute("aria-atomic","true");b.classList.add("embeddedMessagingLiveRegion");R().appendChild(b)}};B.prototype.createFilePreviewFrame=function(){const a=
document.createElement("iframe"),b=new URL(`${G()}/assets/htdocs/filepreview${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);a.classList.add("embeddedMessagingFilePreviewFrame");a.id="embeddedMessagingFilePreviewFrame";a.name="embeddedMessagingFilePreviewFrame";a.src=b.href;a.title=D("EmbeddedMessagingIframesAndContents","FilePreviewIframeTitle")||"Enlarged image preview";a.onload=()=>{m("createFilePreviewFrame","Created an iframe for file preview.")};
embeddedservice_bootstrap.filePreviewFrame=a;document.body.appendChild(a)};B.prototype.createIframe=function(){return new Promise((a,b)=>{try{const c=R(),d=document.createElement("iframe"),e=lc();d.title=D("EmbeddedMessagingIframesAndContents","MessagingIframeTitle")||"Chat with an Agent";d.className="embeddedMessagingFrame";d.id="embeddedMessagingFrame";d.onload=a;d.onerror=b;d.style.backgroundColor="transparent";d.allowTransparency="true";d.setAttribute("aria-label",D("EmbeddedMessagingChatHeader",
"ChatWindowAssistiveText")||"Chat Window");d.setAttribute("role","dialog");d.setAttribute("aria-modal","true");za()&&d.classList.add("embeddedMessagingFrameInline");embeddedservice_bootstrap.settings.omitSandbox||(d.sandbox="allow-scripts allow-same-origin allow-modals allow-downloads allow-popups allow-popups-to-escape-sandbox");embeddedservice_bootstrap.settings.isAuraSite?gc(d):hc(d);embeddedservice_bootstrap.settings.hasBottomTabBar&&(d.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),
d.classList.add("embeddedMessagingFrameMaximizedBottomTabBar"));navigator.userAgent.includes("CommunityHybridContainer")||navigator.userAgent.includes("playgroundcommunity")?d.classList.add("eswMobilePublisher"):ya()?d.classList.add("eswExperienceSite"):Sa()&&d.classList.add("eswIsDesktop");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());
d.onload=()=>{m("createIframe","Created Embedded Messaging frame.")};c.appendChild(e);c.appendChild(d)}catch(c){b(c)}})};B.prototype.bootstrapEmbeddedMessaging=function(){try{return embeddedservice_bootstrap.utilAPI.launchChat()}catch(a){throw Error("[Bootstrap API] Something went wrong bootstrapping Embedded Messaging: "+a);}};B.prototype.maximizeIframe=function(a,b){const c=A();var d=document.getElementById("embeddedMessagingModalOverlay");const e=document.getElementById("embeddedMessagingIconChat"),
l=document.getElementById("embeddedMessagingIconContainer"),n=document.querySelector('meta[name="viewport"]'),g=!!navigator.userAgent.match(/iP(hone|ad|od)/i);a&&(a.classList.add("isMaximized"),a.classList.remove("isMinimized"),a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMaximizedBottomTabBar")),a=b&&b.height?`${b.height}px`:"480px",document.documentElement.style.setProperty("--eswWidth",
b&&b.width?`${b.width}px`:"320px"),document.documentElement.style.setProperty("--eswHeight",a));c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.setAttribute("aria-label",D("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),c.setAttribute("title",D("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),e.style.display="none",document.getElementById("embeddedMessagingIconMinimize")||(b=Ia(Ba.MINIMIZE_MODAL),b.setAttribute("id",
"embeddedMessagingIconMinimize"),b.setAttribute("class","embeddedMessagingIconMinimize"),l.insertBefore(b,e)));d&&!d.classList.contains("isMaximized")&&d.classList.add("isMaximized");Sa()||document.body.classList.contains("embeddedMessagingPreventScrolling")||(document.scrollingElement?embeddedservice_bootstrap.documentScrollPosition=document.scrollingElement.scrollTop:(d=document.documentElement.getBoundingClientRect(),embeddedservice_bootstrap.documentScrollPosition=Math.abs(d.top)),document.body.classList.add("embeddedMessagingPreventScrolling"));
g&&n?(W=n.content,n.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1")):"Android"===Ra().os.name&&"Chrome"===Ra().browser.name&&n&&(W=n.content,n.setAttribute("content","width=device-width, initial-scale=1, minimum-scale=1, interactive-widget=resizes-content"));Ua.test(navigator.userAgent)&&Ta(!0);r("ESW_APP_MAXIMIZATION_RESIZING_COMPLETED");m("maximizeIframe","Maximized the app");y("onEmbeddedMessagingWindowMaximized")};B.prototype.minimizeIframe=function(a,b){const c=
A(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingIconMinimize");b=b.hasMinimizedNotification;a&&(a.classList.remove("isMaximized"),a.classList.add("isMinimized"),b?a.classList.add("hasMinimizedNotification"):a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMaximizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMinimizedBottomTabBar")));e&&e.remove();
c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.removeAttribute("title"),c.removeAttribute("aria-label"));d&&d.classList.contains("isMaximized")&&d.classList.remove("isMaximized");Sa()||(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));W&&zb();Ua.test(navigator.userAgent)&&Ta(!1);r("ESW_APP_MINIMIZATION_RESIZING_COMPLETED");m("minimizeIframe","Minimized the app");
y("onEmbeddedMessagingWindowMinimized")};B.prototype.initializeFeatureObjects=function(){embeddedservice_bootstrap.prechatAPI=new pa;embeddedservice_bootstrap.autoResponseAPI=new Wa;embeddedservice_bootstrap.userVerificationAPI=new Va;embeddedservice_bootstrap.utilAPI=new Q};B.prototype.init=function(a,b,c,d){if(Gb)k("init","Attempted to initialize bootstrap multiple times",null,!0);else{Gb=!0;try{embeddedservice_bootstrap.settings.orgId=a;embeddedservice_bootstrap.settings.eswConfigDevName=b;embeddedservice_bootstrap.settings.siteURL=
c;embeddedservice_bootstrap.settings.snippetConfig=d;z=Za();m("init",`Initialized a new conversationId: ${z}`);$a(d||{});if("string"!==typeof embeddedservice_bootstrap.settings.siteURL||!embeddedservice_bootstrap.settings.siteURL.length)throw Error(`Expected a valid Site URL value to be a string but received: ${embeddedservice_bootstrap.settings.siteURL}.`);if("string"!==typeof embeddedservice_bootstrap.settings.scrt2URL||!embeddedservice_bootstrap.settings.scrt2URL.length)throw Error(`Expected a valid SCRT 2.0 URL value to be a string but received: ${embeddedservice_bootstrap.settings.scrt2URL}.`);
if(!embeddedservice_bootstrap.settings.orgId||!embeddedservice_bootstrap.isOrganizationId(embeddedservice_bootstrap.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+embeddedservice_bootstrap.settings.orgId);if("string"!==typeof embeddedservice_bootstrap.settings.eswConfigDevName||!embeddedservice_bootstrap.settings.eswConfigDevName.length)throw Error(`Expected a valid ESW Config Dev Name value to be a string but received: ${embeddedservice_bootstrap.settings.eswConfigDevName}.`);
try{window.localStorage}catch(g){t("detectWebStorageAvailability","localStorage is not available. User chat sessions continue only in a single-page view and not across multiple pages."),embeddedservice_bootstrap.isLocalStorageAvailable=!1}try{window.sessionStorage}catch(g){t("detectWebStorageAvailability","sessionStorage is not available. User chat sessions end after a web page refresh or across browser tabs and windows."),embeddedservice_bootstrap.isSessionStorageAvailable=!1}Kb();if(!embeddedservice_bootstrap.settings.targetElement)throw Error("No targetElement specified.");
Lb();cc();embeddedservice_bootstrap.settings.hasBottomTabBar=ec();embeddedservice_bootstrap.settings.isAuraSite=!!embeddedservice_bootstrap.settings.isAuraSite;embeddedservice_bootstrap.settings.omitSandbox=!!embeddedservice_bootstrap.settings.omitSandbox;embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel=!!embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel;embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab=!!embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab;
const e=kb().then(Promise.resolve.bind(Promise),()=>kb(G())).catch(()=>{L();throw Error("Error loading CSS.");}),l=lb().then(g=>{m("init","Successfully retrieved configuration settings");$a(g);g=embeddedservice_bootstrap.settings.embeddedServiceConfig;embeddedservice_bootstrap.brandingData=g&&g.branding?g.branding:[];embeddedservice_bootstrap.settings.embeddedServiceConfig.scrt2URL=embeddedservice_bootstrap.settings.scrt2URL;embeddedservice_bootstrap.settings.embeddedServiceConfig.orgId=embeddedservice_bootstrap.settings.orgId;
if(!embeddedservice_bootstrap.settings.embeddedServiceConfig)throw Error("Embedded Service Config settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.name)throw Error("Embedded Service Config developer name not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel)throw Error("Embedded Service Messaging Channel settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode)throw Error("Auth mode setting not present in configuration response.");
if(!Object.values(x).includes(embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode))throw Error("Auth mode in configuration response is invalid.");if(ya()){if(m("init",`Messaging for Web used in ${embeddedservice_bootstrap.settings.snippetConfig.expSiteContext} Experience Site context.`),embeddedservice_bootstrap.settings.expSiteAuthMode)if(O())embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode=x.EXP_SITE_AUTH;
else throw k("init","User verification is not enabled in messaging channel."),Error("User verification is not enabled in messaging channel.");}else m("init","Messaging for Web used in External Site context.");v=`${embeddedservice_bootstrap.settings.orgId}_WEB_STORAGE`;nc()},g=>{k("init","Failed to retrieve configuration settings. Retrying the request");return new Promise((J,M)=>{lb().then(J,M)})}).catch(()=>{L();throw Error("Unable to load Embedded Messaging configuration.");});l.then(()=>{Y("ESW_3RDPARTY_STORAGE_REQUEST",
{orgId:embeddedservice_bootstrap.settings.orgId});embeddedservice_bootstrap.settings.disablePrefetch||Ab()});const n=La().then(Promise.resolve.bind(Promise),g=>mb(g)).catch(g=>{k("init","Failed to retrieve Business Hours data.",g);L();throw Error("Failed to retrieve Business Hours data.");});Promise.all([e,l,n,pc]).then(()=>{p();if(embeddedservice_bootstrap.isLocalStorageAvailable){var g=Object.keys(JSON.parse(localStorage.getItem(v)));m("logWebStorageItemsOnInit",`Local storage items on init: ${g}`)}embeddedservice_bootstrap.isSessionStorageAvailable&&
(g=Object.keys(JSON.parse(sessionStorage.getItem(v))),m("logWebStorageItemsOnInit",`Session storage items on init: ${g}`));embeddedservice_bootstrap.initializeFeatureObjects();embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();if(q(C.JWT)){{K=q(C.JWT);g=embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier||"";var J=Db(K)||{};const M=J.channelAddId||"";J=J.coreRefId||"";embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel&&
g!==M||w()===x.EXP_SITE_AUTH&&J!==embeddedservice_bootstrap.settings.snippetConfig.userId?embeddedservice_bootstrap.userVerificationAPI.clearSession():(w()===x.EXP_SITE_AUTH&&va(),embeddedservice_bootstrap.generateMarkup(!0),Bb(!0))}}else if(w()===x.UNAUTH||w()===x.EXP_SITE_AUTH&&!embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser)w()===x.EXP_SITE_AUTH&&va(),embeddedservice_bootstrap.generateMarkup();za()&&embeddedservice_bootstrap.utilAPI.launchChat()})}catch(e){L(),k("init",`Error: ${e}`)}}};
window.embeddedservice_bootstrap?k("bootstrap load","attempting to load MIAW script when one is already loaded",null,!0):window.embeddedservice_bootstrap=new B})();
